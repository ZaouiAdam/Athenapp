
@{
    ViewBag.Title = "Default step settings";
}
<style>
    select {
        font-family: 'FontAwesome', Calibri
    }
</style>

<h2 style="margin-top:5%;">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.Titre</h2>
<br />

<div class="row">
    <div class="col-lg-5">
        <div class="card card-default">
            <div class="card-header">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.Profil</div>
            <div class="card-body">
                <div class="col-lg-1"></div>
                <div class="col-lg-10 form-group">
                    <div class="col-lg-12">
                        <div id="BlockSelectGroup">
                            <div id="RemoveBlockAddGroup">
                                <select class="form-control" id="SelectGroup" onchange="ListStep(); CheckShowAddTexteStep();">
                                    <option value="0">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.SelectItemTitle</option>
                                </select>
                            </div>
                        </div>
                        <br />
                        <button class="btn btn-success" data-toggle="modal" data-target="#ModalAddGroup" data-backdrop="static" data-keyboard="false" onclick="AddGroupModal();">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.BtnAjouter</button>
                        <button class="btn btn-primary" data-toggle="modal" data-target="#ModalUpdateGroup" data-backdrop="static" data-keyboard="false" onclick="ModalUpdateGroup();">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.BtnModifier</button>
                        <button class="btn btn-danger" data-toggle="modal" data-target="#ModalDeleteGroup" data-backdrop="static" data-keyboard="false" onclick="ModalDeleteGroup();">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalDeleteStepBtnDelete</button>
                    </div>
                </div>
                <div class="col-lg-12"></div>
                <br />
            </div>
        </div>
    </div>
</div>

<br />

@* Affichage Etape Defaut *@
<div class="row">
    <div class="col-lg-10">
        <div class="card card-default">
            <div class="card-header">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.TitreCard</div>
            <div class="card-body" style="text-align:center;" id="StepCard">
                <table class="table table-responsive" id="DivTableEtape">
                    <tr>
                        <th style="text-align:center;">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.Numero</th>
                        <th style="text-align:center;">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.Explication</th>
                        <th style="text-align:center;">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.Incoterm</th>
                        <th style="text-align:center;">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.Action</th>
                    </tr>
                    <tbody id="TableEtape"></tbody>
                </table>
                <br />
            </div>
        </div>
    </div>
</div>

@* Modal Add Group *@
<div class="modal fade" id="ModalAddGroup" role="dialog">
    <div class="modal-dialog modal-lg">
        <div style="margin-top:25%;"></div>
        <div class="modal-content" style="text-align:center;">
            <div class="modal-header" style="background-color:#337AB7;border-color:#0080CD;color:white;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.AddGroupCardTitle</h4>
            </div>
            <div class="modal-body" style="text-align:center;">
                @* Contenu de a fonction AddGroup *@
                <div id="TableBodyAddGroup">
                    <div class="modal-body" style="text-align:center;">
                        <input type="text" class="form-control" id="AddGroupValue" placeholder="@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.PlaceholderNewGroup">
                    </div>
                    <div class="modal-footer" style="text-align:center;">
                        <button class="btn btn-success" onclick="AddGroup();">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.BtnAjouter</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@* Modal Update Group *@
<div class="modal fade" id="ModalUpdateGroup" role="dialog">
    <div class="modal-dialog modal-lg">
        <div style="margin-top:25%;"></div>
        <div class="modal-content" style="text-align:center;">
            <div class="modal-header" style="background-color:#337AB7;border-color:#0080CD;color:white;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.EditGroupCardTitle</h4>
            </div>
            <div class="modal-body" style="text-align:center;">
                @* Contenu de a fonction UpdateGroup *@
                <div id="TableBodyUpdateGroup">
                    <div class="modal-body" style="text-align:center;">
                        <input type="text" class="form-control" id="UpdateGroupValue" placeholder="@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.PlaceholderNewGroup" value="">
                        <input type="hidden" id="UpdateGroupIdValue" value="" />
                    </div>
                    <div class="modal-footer" style="text-align:center;">
                        <button class="btn btn-warning" onclick="UpdateGroup();">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalUpdateStepBtnEditer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@* Modal Delete Group *@
<div class="modal fade" id="ModalDeleteGroup" role="dialog">
    <div class="modal-dialog modal-lg">
        <div style="margin-top:25%;"></div>
        <div class="modal-content" style="text-align:center;">
            <div class="modal-header" style="background-color:#337AB7;border-color:#0080CD;color:white;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.DeleteGroupCardTitle</h4>
            </div>
            <div class="modal-body" style="text-align:center;">
                @* Contenu de a fonction AddGroup *@
                <div id="TableBodyDeleteGroup">
                </div>
            </div>
        </div>
    </div>
</div>

@* Modal Lien *@
<div class="modal fade" id="ModalLink" role="dialog">
    <div class="modal-dialog modal-lg">
        <div style="margin-top:25%;"></div>
        <div class="modal-content" style="text-align:center;">
            <div class="modal-header" style="background-color:#337AB7;border-color:#0080CD;color:white;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalLinkReadTitre</h4>
            </div>
            <div class="modal-body" style="text-align:center;">
                @* Contenu de a fonction ListLinkHelper *@
                <div id="TableBodyLink">

                </div>
            </div>
        </div>
    </div>
</div>

@* Modal Ajout Lien *@
<div class="modal fade" id="ModalAddLink" role="dialog">
    <div class="modal-dialog modal-lg">
        <div style="margin-top:25%;"></div>
        <div class="modal-content" style="text-align:center;">
            <div class="modal-header" style="background-color:#337AB7;border-color:#0080CD;color:white;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalLinkWriteTitre</h4>
            </div>
            <div class="modal-body" style="text-align:center;">
                @* Contenu de a fonction ListLinkHelper *@
                <div id="TableAddLink">

                </div>
            </div>
        </div>
    </div>
</div>


@* Modal Update *@
<div class="modal fade" id="ModalUpdateStep" role="dialog">
    <div class="modal-dialog modal-lg">
        <div style="margin-top:25%;"></div>
        <div class="modal-content" style="text-align:center;">
            <div class="modal-header" style="background-color:#337AB7;border-color:#0080CD;color:white;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalUpdateStepTitre</h4>
            </div>
            <div class="modal-body" id="BlockBodyUpdateStep" style="text-align:center;">
                @* Contenu de a fonction ListLinkHelper *@
            </div>
            <div class="modal-footer" style="text-align:center;">
                <button type="button" class="btn btn-warning" onclick="UpdateStep();" aria-hidden="true"> @ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalUpdateStepBtnEditer</button>
            </div>
        </div>
    </div>
</div>

@* Modal Delete *@
<div class="modal fade" id="ModalDeleteStep" role="dialog">
    <div class="modal-dialog modal-lg">
        <div style="margin-top:25%;"></div>
        <div class="modal-content" style="text-align:center;">
            <div class="modal-header" style="background-color:#337AB7;border-color:#0080CD;color:white;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalDeleteStepTitre</h4>
            </div>
            <div id="BlockBodyDeleteStep" style="text-align:center;">
                @* Contenu de a fonction ListLinkHelper *@
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="GardenIdStep" value="0" />
<input type="hidden" id="MaxGardenIdStep" value="0" />

<script>
    // Demarrage
    $(document).ready(function () {
        ListGroup(0);
        ListStep();
        UpdateOrderStep();
    });

    // Afficher l'entrer des nouvelle étapes
    function CheckShowAddTexteStep() {
        var GroupId = document.getElementById("SelectGroup").value;
        if (GroupId == "0") {
            $('#AddButton').remove();
        } else {
            $('#AddButton').remove();
            $('#StepCard').append('<div id="AddButton">'+
                                  '<div class="col-lg-1"></div>'+
                                  '<div class="col-lg-8"><input type="text" class="form-control" id="NouvelleEtapeText" placeholder="@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.PlaceholderEtape" /></div>'+
                                  '<div class="col-lg-3"><button class="btn btn-success" onclick="InsertStep();">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.BtnAjouter</button></div>'+
                              '</div>');
        }

    }

    // List Group Select
    function ListGroup(IdGroup) {

        $.ajax({
            url: 'EtapeDefaut/ListGroup',
            type: "POST",
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            $('#RemoveBlockAddGroup').remove();
            $('#BlockSelectGroup').append('<div id="RemoveBlockAddGroup"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet"/><select class="form-control fontawesome" id="SelectGroup" onchange="ListStep(); CheckShowAddTexteStep();"><option value="0">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.PlaceholderSelectGroup</option></select></div>');
            var iNom = 0;
            $(data).each(function (Index, emp) {
                var ArrayGroup = emp.Value.split('EtapeValue');
                iNom++;
                if (IdGroup == ArrayGroup[0]) {
                    if (ArrayGroup[2] == "1") {
                        $('#SelectGroup').append('<option class="fontawesome" value="' + ArrayGroup[0] + '" id="NewGroup' + iNom + '" selected>' + ArrayGroup[1] + ' &#xf005;</option>');
                    } else {
                        $('#SelectGroup').append('<option class="fontawesome" value="' + ArrayGroup[0] + '" id="NewGroup' + iNom + '" selected>' + ArrayGroup[1] + '</option>');
                    }
                } else {
                    if (ArrayGroup[2] == "1") {
                        $('#SelectGroup').append('<option class="fontawesome" value="' + ArrayGroup[0] + '" id="NewGroup' + iNom + '">' + ArrayGroup[1] + ' &#xf005;</option>');
                    } else {
                        $('#SelectGroup').append('<option class="fontawesome" value="' + ArrayGroup[0] + '" id="NewGroup' + iNom + '">' + ArrayGroup[1] + '</option>');
                    }
                }
            });
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Ajout Etape
    function AddGroup() {
        var NouveauGroupTexte = document.getElementById("AddGroupValue").value;
        $.ajax({
            url: 'EtapeDefaut/AddGroup',
            type: "POST",
            data: { NouveauGroupTexte: NouveauGroupTexte },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            switch (data) {
                case 'Success':
                    $("body").overhang({
                        type: "Success",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.AddGroup"),
                    });
                    document.getElementById("AddGroupValue").value = "";
                    document.getElementById("AddGroupValue").style.border = "1px solid #CCCCCC";
                    $('.modal').modal('hide').data('bs.modal', null);
                    break;
                case 'Error':
                    $("body").overhang({
                        type: "Warning",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.AddGroupFail"),
                    });
                    break;
                case 'ErrorTextEmpty':
                    $("body").overhang({
                        type: "Warning",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.EmptyTexte"),
                    });
                    document.getElementById("AddGroupValue").style.border = "1px solid red";
                    break;
            }
            ListGroup(0);
            ListStep();
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Modal Update Group
    function ModalUpdateGroup() {
        var GroupId = document.getElementById("SelectGroup").value;

        $.ajax({
            url: 'EtapeDefaut/ModalUpdateGroup',
            type: "POST",
            data: { GroupId: GroupId },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            if (data == "Empty") {
                    $("body").overhang({
                    type: "warn",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.NoGroupSelected"),
                });
                $('.modal').modal('hide').data('bs.modal', null);
            } else {
                document.getElementById("UpdateGroupValue").value = data;
            }
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Update Group
    function UpdateGroup() {
        var GroupId = document.getElementById("SelectGroup").value;
        var NameGroup = document.getElementById("UpdateGroupValue").value;

        $.ajax({
            url: 'EtapeDefaut/UpdateGroup',
            type: "POST",
            data: { GroupId: GroupId, NameGroup: NameGroup },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            if (data == "Empty") {
                    $("body").overhang({
                    type: "warn",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.NoGroupSelected"),
                });
                $('.modal').modal('hide').data('bs.modal', null);
            }
            if (data == "Success") {
                    $("body").overhang({
                    type: "success",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.UpdateGroupSuccess"),
                });
                $('.modal').modal('hide').data('bs.modal', null);
            }
            ListGroup(GroupId);
            ListStep();
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Ajout Group
    function ModalDeleteGroup() {
        var GroupId = document.getElementById("SelectGroup").value;

        $.ajax({
            url: 'EtapeDefaut/ModalDeleteGroup',
            type: "POST",
            data: { GroupId: GroupId },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            if (data == "Empty") {
                    $("body").overhang({
                    type: "warn",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.NoGroupSelected"),
                });
                $('.modal').modal('hide').data('bs.modal', null);
            } else {
                var ArrayGroup = data.split('GroupValue');
                $('#BlockBodyDeleteGroup').remove();
                $('#TableBodyDeleteGroup').append('<div id="BlockBodyDeleteGroup">' +
                    '<div class="modal-body" style="text-align:center;"><label>@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.DeleteMessagePart1' + ArrayGroup[1] + '@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.DeleteMessagePart2</label></div>' +
                    '<div class="modal-footer" style="text-align:center;"><button class="btn btn-danger" onclick="DeleteGroup(' + ArrayGroup[0] + ');">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalDeleteStepBtnDelete</button></div>' +
                    '</div>');
            }
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Delete Group
    function DeleteGroup(IdGroup) {

        var GroupId = document.getElementById("SelectGroup").value;

        $.ajax({
            url: 'EtapeDefaut/DeleteGroup',
            type: "POST",
            data: { IdGroup: IdGroup, GroupId: GroupId },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            if (data == "Success") {
                $("body").overhang({
                    type: "success",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.DeleteGroup"),
                });
                $('.modal').modal('hide').data('bs.modal', null);
                ListGroup(0);
            }
            if (data == "Error") {
                $("body").overhang({
                    type: "Error",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.DeleteGroupFail"),
                });
            }
            if (data == "Impossible") {
                $("body").overhang({
                    type: "Error",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ImpossibleDeleteGroup"),
                });
            }
            ListGroup(0);
            ListStep();
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    function decode(str) {
        var textArea = document.createElement('textarea');
        textArea.innerHTML = str;
        return textArea.value;
    }

    // Drag and drop changement ordre Etape
    function UpdateOrderStep() {

        $("#TableEtape").sortable({
            update: function (event, ui) {
                var itemIds = "";
                var i = 0;
                $("#TableEtape").find(".taskSingleInline").each(function () {
                    var itemId = $(this).attr("data-taskid");
                    if (i == 0) {
                        itemIds = itemId;
                    } else {
                        itemIds = itemIds + "," + itemId;
                    }
                    i++;
                });

                var GroupId = document.getElementById("SelectGroup").value;

                $.ajax({
                    url: 'EtapeDefaut/UpdateOrderStep',
                    type: "POST",
                    data: { itemIds: itemIds, GroupId: GroupId },
                    success: successFunc,
                    error: errorFunc
                });
                function successFunc(data, status) {
                    if (data == "Error_Step") {
                        $("body").overhang({
                            type: "warn",
                            message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.UpdateOrderFunction"),
                        });
                    }
                    if (data == "Success") {
                        $("body").overhang({
                            type: "success",
                            message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.UpdateOrderFunction"),
                        });
                    }
                    ListStep();
                }
                function errorFunc() {
                    $("body").overhang({
                        type: "Error",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
                    });
                }
            }
        });
    }

    // Liste Etape
    function ListStep() {
        var ChoixIncoterm = document.getElementById('SelectGroup').value;

        $.ajax({
            url: 'EtapeDefaut/ListStep',
            type: "POST",
            data: { ChoixIncoterm: ChoixIncoterm},
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            for (var i = 1; i <= document.getElementById('MaxGardenIdStep').value; i++) {
                $('#NewEtape' + i).remove();
            }
            var iStep = 0;
            $(data).each(function (Index, emp) {
                var ArrayStep = emp.Value.split('EtapeValue');
                iStep++;
                if (ArrayStep[3]) {
                    $('#TableEtape').append('<tr id="NewEtape' + iStep + '"><td class="taskSingleInline" data-taskid="' + ArrayStep[2] + '">' + iStep + '</td><td><label>' + ArrayStep[0] + '</label> ' +
                        '<label onclick="ListLinkRead(' + ArrayStep[2] + ');" data-toggle="modal" data-target="#ModalLink" data-backdrop="static" data-keyboard="false" class="label-link">@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.BtnDocument</label></td>' +
                        '<td><label>' + ArrayStep[1] + '</label></td><td>' +
                        '<button class="btn btn-primary" data-toggle="modal" data-target="#ModalUpdateStep" data-backdrop="static" data-keyboard="false" onclick="UpdateStepModal(' + ArrayStep[2] + ');">' +
                        '<i class="fa fa-pencil"></i></button>' +
                        ' <button class="btn btn-danger" data-toggle="modal" data-target="#ModalDeleteStep" data-backdrop="static" data-keyboard="false" onclick="DeleteStepModal(' + ArrayStep[2] + ');">' +
                        '<i class="fa fa-trash"></i></button>' +
                        ' <button class="btn btn-info" data-toggle="modal" data-target="#ModalAddLink" data-backdrop="static" data-keyboard="false" onclick="ListLinkWrite(' + ArrayStep[2] + ');">' +
                        '<i class="fa fa-link"></i></button>' +
                        '</td></tr>');
                } else {
                    $('#TableEtape').append('<tr id="NewEtape' + iStep + '"><td class="taskSingleInline" data-taskid="' + ArrayStep[2] + '">' + iStep + '</td><td><label>' + ArrayStep[0] + '</label> </td>' +
                        '<td><label>' + ArrayStep[1] + '</label></td><td>' +
                        '<button class="btn btn-primary" data-toggle="modal" data-target="#ModalUpdateStep" data-backdrop="static" data-keyboard="false" onclick="UpdateStepModal(' + ArrayStep[2] + ');">' +
                        '<i class="fa fa-pencil"></i></button>' +
                        ' <button class="btn btn-danger" data-toggle="modal" data-target="#ModalDeleteStep" data-backdrop="static" data-keyboard="false" onclick="DeleteStepModal(' + ArrayStep[2] + ');">' +
                        '<i class="fa fa-trash"></i></button>' +
                        ' <button class="btn btn-info" data-toggle="modal" data-target="#ModalAddLink" data-backdrop="static" data-keyboard="false" onclick="ListLinkWrite(' + ArrayStep[2] + ');">' +
                        '<i class="fa fa-link"></i></button>' +
                        '</td></tr>');
                }
            });
            document.getElementById('MaxGardenIdStep').value = iStep;
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }


    // Liste Mise à jour Etape
    function UpdateStepModal(UpdateId) {
        $.ajax({
            url: 'EtapeDefaut/ListStepUpdate',
            type: "POST",
            data: { UpdateId: UpdateId },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            $(data).each(function (Index, emp) {
                var ArrayIncoterm = emp.Value.split('/');
                $('#BlockBodyUpdateStepOld').remove();
                $('#BlockBodyUpdateStep').append('<div id="BlockBodyUpdateStepOld"><input type="text" class="form-control" id="EditStepName" value="' + ArrayIncoterm[1] + '"/>' +
                    '<input type="hidden" id="EditStepId" value="' + ArrayIncoterm[0] + '"/><br />');
            });
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Mise à jour Etape
    function UpdateStep() {
        var UpdateName = document.getElementById("EditStepName").value;
        var UpdateId = document.getElementById("EditStepId").value;
        $.ajax({
            url: 'EtapeDefaut/UpdateStep',
            type: "POST",
            data: { UpdateId: UpdateId, UpdateName: UpdateName },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            $("body").overhang({
                type: "Success",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.UpdateStep"),
            });
            $('.modal').modal('hide').data('bs.modal', null);
            ListStep();
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.FailUpdateStep"),
            });
        }
    }

    // Liste Suppression Étape
    function DeleteStepModal(DeleteId) {
        $.ajax({
            url: 'EtapeDefaut/ListStepDelete',
            type: "POST",
            data: { DeleteId: DeleteId },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            $(data).each(function (Index, emp) {
                var ArrayStepDelete = emp.Value.split('InfoStep:');
                $('#BlockBodyUpdateStepOld').remove();
                $('#BlockBodyDeleteStep').append('<div id="BlockBodyUpdateStepOld"><div class="modal-body" style="text-align:center;">' +
                    '<label>@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalDeleteTexte</label></div>' +
                    '<div class="modal-footer" style="text-align:center;"> <button class="btn btn-danger" onclick="DeleteStep(' + ArrayStepDelete[0] + ');">' +
                    ' @ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalDeleteStepBtnDelete</button> </div>');
            });
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }


    // Suppression Etape
    function DeleteStep(DeleteId) {
        $.ajax({
            url: 'EtapeDefaut/DeleteStep',
            type: "POST",
            data: { DeleteId: DeleteId },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            if (data == "Success") {
                $("body").overhang({
                    type: "Success",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.DeleteFunction"),
                });
                $('.modal').modal('hide').data('bs.modal', null);
            } else {
                $("body").overhang({
                    type: "Warning",
                    message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.FailDeleteFunction"),
                });
            }
            ListStep();
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Ajout Etape
    function InsertStep() {
        var NouvelleEtapeText = document.getElementById("NouvelleEtapeText").value;
        var IdGroup = document.getElementById("SelectGroup").value;
        $.ajax({
            url: 'EtapeDefaut/InsertStep',
            type: "POST",
            data: { CodeClient: 1, NouvelleEtapeText: NouvelleEtapeText, IdGroup: IdGroup },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            switch (data) {
                case 'Success':
                    $("body").overhang({
                        type: "Success",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.AddStepFunction"),
                    });
                    document.getElementById("NouvelleEtapeText").value = "";
                    document.getElementById("NouvelleEtapeText").style.border = "1px solid #CCCCCC";
                    break;
                case 'Error':
                    $("body").overhang({
                        type: "Warning",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.FailAddStepFunction"),
                    });
                    break;
                case 'ErrorTextEmpty':
                    $("body").overhang({
                        type: "Warning",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.EmptyTexte"),
                    });
                    document.getElementById("NouvelleEtapeText").style.border = "1px solid red";
                    break;
            }
            ListStep();
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Liste Lien Lecture
    function ListLinkRead(StepId) {
        $.ajax({
            url: 'EtapeDefaut/ListLinkRead',
            type: "POST",
            data: { StepId: StepId },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            var ArrayStepLink = data.split('LienStringNom:');
            var iLink = 0;
            var donnees = [];
            $(ArrayStepLink).each(function (Index, ArrayLink) {
                var ArrayStepURL = ArrayStepLink[iLink].split('LienStringURL:');
                donnees[iLink] = [ArrayStepURL[0], ArrayStepURL[1], '<a href="' + ArrayStepURL[1] + '" target="_blank"><i class="fa fa-external-link"></i></a>'];
                iLink++;
            });
            $('#BlockBodyLink').remove();
            $('#BlockBodyLink_wrapper').remove();

            $('#TableBodyLink').append('<table id="BlockBodyLink" class="table table-striped table-bordered" width="99%">' +
                '<thead>' +
                '   <tr>' +
                '       <td><label> @ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalLinkNom </label></td>' +
                '       <td><label> @ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalLinkUrl </label></td>' +
                '       <td><label> @ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalLinkLien </label></td>' +
                '   </tr>' +
                '</thead>' +
                '<tbody id="trtable"></tbody>' +
                '</table><br>');

            $('#BlockBodyLink').DataTable({
                data: donnees
            });
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Ajout lien Ecriture
    function ListLinkWrite(StepId) {
        $.ajax({
            url: 'EtapeDefaut/ListLinkWrite',
            type: "POST",
            data: { StepId: StepId },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            var iLink = 0;
            var donnees = [];
            $(data).each(function (Index, emp) {
                var ArrayLink = emp.Value.split('LienStringUrl:');
                if (ArrayLink[3] == 0) {
                    donnees[iLink] = [ArrayLink[0], ArrayLink[1], '<button class="btn btn-info" onclick="AddLink(' + ArrayLink[2] + ')"> <i class="fa fa-plus"></i> </button>'];
                } else {
                    donnees[iLink] = [ArrayLink[0], ArrayLink[1], '<button class="btn btn-danger" onclick="RemoveLink(' + ArrayLink[2] + ')"> <i class="fa fa-times"></i> </button>'];
                }
                iLink++;
            });
            document.getElementById("GardenIdStep").value = StepId;

            $('#BlockAddLink').remove();
            $('#BlockAddLink_wrapper').remove();

            $('#TableAddLink').append('<table id="BlockAddLink" class="table table-striped table-bordered" width="99%">' +
                '<thead>' +
                '   <tr>' +
                '       <td><label> @ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalLinkNom </label></td>' +
                '       <td><label> @ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ModalLinkUrl </label></td>' +
                '       <td><label> @ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.Action </label></td>' +
                '   </tr>' +
                '</thead>' +
                '<tbody id="trtable"></tbody>' +
                '</table>');

            $('#BlockAddLink').DataTable({
                data: donnees
            });
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Ajout lien
    function AddLink(LinkId) {
        var StepIdModal = document.getElementById("GardenIdStep").value;
        $.ajax({
            url: 'EtapeDefaut/AddLink',
            type: "POST",
            data: { LinkId: LinkId, StepIdModal: StepIdModal },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            ListStep();
            ListLinkWrite(StepIdModal);
            switch (data) {
                case 'Success':
                    $("body").overhang({
                        type: "Success",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.AddLinkFunction"),
                    });
                    break;
                case 'Error':
                    $("body").overhang({
                        type: "Error",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.FailAddLinkFunction"),
                    });
                    break;
            }
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

    // Suppression lien
    function RemoveLink(LinkId) {
        var StepIdModal = document.getElementById("GardenIdStep").value;
        $.ajax({
            url: 'EtapeDefaut/RemoveLink',
            type: "POST",
            data: { LinkId: LinkId, StepIdModal: StepIdModal },
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            ListStep();
            ListLinkWrite(StepIdModal);
            switch (data) {
                case 'Success':
                    $("body").overhang({
                        type: "Success",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.DeleteLinkFunction"),
                    });
                    break;
                case 'Error':
                    $("body").overhang({
                        type: "Error",
                        message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.FailDeleteLinkFunction"),
                    });
                    break;
            }
        }

        function errorFunc() {
            $("body").overhang({
                type: "Error",
                message: decode("@ExpeditionHelper_SOL.Resources.Views.EtapeDefaut.Index.ErrorFunction"),
            });
        }
    }

</script>